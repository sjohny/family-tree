:root {
  --bg:#faf7f2; --bg-warm:#f5f0e8; --card:#ffffff;
  --text:#3a3028; --text-soft:#7a6f63; --text-muted:#a89e93;
  --accent:#8b7355; --accent-light:#c4a882; --accent-warm:#d4a574;
  --border:#e6ddd1; --border-light:#efe8de; --gold:#c9a96e;
  --shadow:rgba(60,48,30,0.08); --shadow-md:rgba(60,48,30,0.12);
  --line-color:#b8ad9e; --male:#7a92a8; --female:#b08a9a;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:'Source Sans 3',sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
}
body::before{
  content:'';
  position:fixed; inset:0;
  background:
    radial-gradient(ellipse at 20% 20%,rgba(201,169,110,0.06) 0%,transparent 50%),
    radial-gradient(ellipse at 80% 80%,rgba(176,138,154,0.05) 0%,transparent 50%);
  pointer-events:none;
  z-index:0;
}

/* Header */
.app-header{
  position:sticky; top:0; z-index:100;
  background:rgba(250,247,242,0.92);
  backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border-light);
  padding:0 2rem;
}
.header-inner{
  max-width:1400px; margin:0 auto;
  display:flex; align-items:center; justify-content:space-between;
  height:64px;
}
.header-title{
  font-family:'Playfair Display',serif;
  font-size:1.5rem; font-weight:600;
  cursor:pointer;
  user-select:none;
}
.header-title span{color:var(--accent-warm);}
.header-actions{display:flex; gap:0.5rem; align-items:center;}

/* Buttons */
.btn{
  display:inline-flex; align-items:center; gap:0.4rem;
  padding:0.5rem 1rem;
  border:1px solid var(--border);
  border-radius:8px;
  background:var(--card);
  color:var(--text);
  font-family:'Source Sans 3',sans-serif;
  font-size:0.85rem; font-weight:500;
  cursor:pointer;
  transition:all 0.2s;
  white-space:nowrap;
}
.btn:hover{border-color:var(--accent-light); box-shadow:0 2px 8px var(--shadow);}
.btn-primary{background:var(--accent); color:#fff; border-color:var(--accent);}
.btn-primary:hover{background:#7a6348;}
.btn-danger{color:#c0392b; border-color:#e8c4c0;}
.btn-danger:hover{background:#fdf0ef; border-color:#c0392b;}
.btn-sm{padding:0.35rem 0.75rem; font-size:0.8rem;}
.btn-icon{width:36px; height:36px; padding:0; display:inline-flex; align-items:center; justify-content:center; border-radius:8px;}

/* Tree */
.tree-container{position:relative; z-index:1; min-height:calc(100vh - 64px); overflow:auto;}
.tree-title-section{text-align:center; padding:2rem 0 1rem;}
.tree-title-section h1{font-family:'Playfair Display',serif; font-size:2.2rem; font-weight:600;}
.tree-title-section .subtitle{font-family:'Lora',serif; font-size:0.95rem; color:var(--text-muted); font-style:italic;}

#treeCanvas{position:relative; margin:0 auto;}
#treeSvg{position:absolute; top:0; left:0; pointer-events:none; z-index:0;}
#treeSvg line{stroke:var(--line-color); stroke-width:1.8; stroke-linecap:round;}

.tree-node{
  position:absolute;
  display:flex; flex-direction:column; align-items:center; gap:4px;
  cursor:pointer;
  transition:transform 0.2s;
  z-index:1;
}
.tree-node:hover{transform:translateY(-3px);}
.tree-node .photo{
  width:76px; height:76px;
  border-radius:50%;
  border:3px solid var(--border);
  overflow:hidden;
  background:var(--bg-warm);
  display:flex; align-items:center; justify-content:center;
  box-shadow:0 3px 12px var(--shadow);
  transition:all 0.3s;
}
.tree-node:hover .photo{border-color:var(--accent-light); box-shadow:0 6px 20px var(--shadow-md);}
.tree-node .photo img{width:100%; height:100%; object-fit:cover;}
.tree-node .photo .initials{font-family:'Playfair Display',serif; font-size:1.3rem; font-weight:500; color:var(--text-muted);}
.tree-node .photo.male{border-color:var(--male);}
.tree-node .photo.female{border-color:var(--female);}
.tree-node .name{
  font-family:'Lora',serif;
  font-size:0.78rem; font-weight:500;
  text-align:center; line-height:1.2;
  max-width:100px;
}
.tree-node .dates{font-size:0.68rem; color:var(--text-muted); text-align:center;}
.tree-node .maiden{font-size:0.68rem; color:var(--text-soft); font-style:italic;}

.gen-label-abs{
  position:absolute;
  font-family:'Lora',serif;
  font-size:0.65rem;
  text-transform:uppercase;
  letter-spacing:0.12em;
  color:var(--text-muted);
  z-index:2;
  white-space:nowrap;
  user-select:none;
}

/* Empty */
.empty-state{text-align:center; padding:4rem 2rem; max-width:500px; margin:0 auto;}
.empty-state .tree-icon{font-size:4rem; margin-bottom:1.5rem; opacity:0.5;}
.empty-state h2{font-family:'Playfair Display',serif; font-size:1.6rem; font-weight:500; margin-bottom:0.75rem;}
.empty-state p{color:var(--text-soft); font-size:0.95rem; margin-bottom:1.5rem; line-height:1.6;}

/* Modal */
.modal-overlay{
  position:fixed; inset:0;
  background:rgba(58,48,40,0.4);
  backdrop-filter:blur(4px);
  z-index:1000;
  display:flex; align-items:center; justify-content:center;
  padding:1rem;
  opacity:0; visibility:hidden;
  transition:all 0.3s;
}
.modal-overlay.active{opacity:1; visibility:visible;}
.modal{
  background:var(--card);
  border-radius:16px;
  box-shadow:0 20px 60px rgba(58,48,40,0.25);
  width:100%; max-width:520px;
  max-height:90vh;
  overflow-y:auto;
  transform:translateY(20px);
  transition:transform 0.3s;
}
.modal-overlay.active .modal{transform:translateY(0);}
.modal-header{padding:1.5rem 1.5rem 0; display:flex; align-items:center; justify-content:space-between;}
.modal-header h2{font-family:'Playfair Display',serif; font-size:1.3rem; font-weight:600;}
.modal-body{padding:1.25rem 1.5rem 1.5rem;}
.modal-footer{padding:0 1.5rem 1.5rem; display:flex; gap:0.5rem; justify-content:flex-end;}

/* Form */
.form-row{display:flex; gap:0.75rem; margin-bottom:0.75rem;}
.form-group{flex:1; margin-bottom:0.75rem;}
.form-row .form-group{margin-bottom:0;}
.form-group label{
  display:block;
  font-size:0.78rem; font-weight:500;
  color:var(--text-soft);
  margin-bottom:0.3rem;
  text-transform:uppercase;
  letter-spacing:0.05em;
}
.form-group input,.form-group select,.form-group textarea{
  width:100%;
  padding:0.6rem 0.8rem;
  border:1px solid var(--border);
  border-radius:8px;
  font-family:'Source Sans 3',sans-serif;
  font-size:0.9rem;
  color:var(--text);
  background:var(--bg);
  transition:border-color 0.2s;
}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{
  outline:none;
  border-color:var(--accent-light);
  box-shadow:0 0 0 3px rgba(196,168,130,0.15);
}
.form-group textarea{resize:vertical; min-height:60px;}
.form-group .help-text{font-size:0.72rem; color:var(--text-muted); margin-top:0.25rem;}
.photo-preview-row{display:flex; gap:0.75rem; align-items:flex-end;}
.photo-preview-row .form-group{flex:1;}
.photo-preview{
  width:56px; height:56px;
  border-radius:50%;
  border:2px solid var(--border);
  overflow:hidden;
  background:var(--bg-warm);
  flex-shrink:0;
  display:flex; align-items:center; justify-content:center;
}
.photo-preview img{width:100%; height:100%; object-fit:cover;}
.photo-preview .preview-placeholder{font-size:0.65rem; color:var(--text-muted); text-align:center;}

/* Detail panel */
.detail-panel{
  position:fixed;
  right:-420px;
  top:64px;
  width:400px;
  height:calc(100vh - 64px);
  background:var(--card);
  border-left:1px solid var(--border);
  box-shadow:-4px 0 20px var(--shadow);
  z-index:200;
  transition:right 0.35s cubic-bezier(0.4,0,0.2,1);
  overflow-y:auto;
  padding:1.5rem;
}
.detail-panel.open{right:0;}
.detail-panel-header{display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1.5rem;}
.detail-photo{
  width:100px; height:100px;
  border-radius:50%;
  border:3px solid var(--border);
  overflow:hidden;
  background:var(--bg-warm);
  margin:0 auto 1rem;
  display:flex; align-items:center; justify-content:center;
}
.detail-photo.male{border-color:var(--male);}
.detail-photo.female{border-color:var(--female);}
.detail-photo img{width:100%; height:100%; object-fit:cover;}
.detail-photo .initials{font-family:'Playfair Display',serif; font-size:2rem; color:var(--text-muted);}
.detail-name{font-family:'Playfair Display',serif; font-size:1.4rem; text-align:center; margin-bottom:0.25rem;}
.detail-maiden{text-align:center; font-style:italic; color:var(--text-soft); font-size:0.9rem; margin-bottom:0.5rem;}
.detail-dates{text-align:center; color:var(--text-muted); font-size:0.85rem; margin-bottom:1rem;}
.detail-bio{
  color:var(--text-soft);
  font-size:0.9rem;
  line-height:1.6;
  padding:1rem;
  background:var(--bg);
  border-radius:8px;
  margin-bottom:1rem;
  white-space:pre-wrap;
}
.detail-relations{margin-top:1rem;}
.detail-relations h4{
  font-family:'Lora',serif;
  font-size:0.85rem;
  font-weight:500;
  color:var(--text-soft);
  text-transform:uppercase;
  letter-spacing:0.05em;
  margin-bottom:0.5rem;
}
.detail-rel-item{display:flex; align-items:center; gap:0.5rem; padding:0.5rem 0; cursor:pointer;}
.detail-rel-item:hover{color:var(--accent);}
.detail-rel-item .mini-photo{
  width:32px; height:32px;
  border-radius:50%;
  border:2px solid var(--border);
  overflow:hidden;
  background:var(--bg-warm);
  display:flex; align-items:center; justify-content:center;
  flex-shrink:0;
}
.detail-rel-item .mini-photo img{width:100%; height:100%; object-fit:cover;}
.detail-rel-item .mini-photo .initials{font-size:0.6rem; color:var(--text-muted);}
.detail-actions{display:flex; gap:0.5rem; margin-top:1.5rem; padding-top:1rem; border-top:1px solid var(--border-light);}

/* Dropdown */
.dropdown{position:relative;}
.dropdown-menu{
  position:absolute;
  top:100%; right:0;
  margin-top:4px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:10px;
  box-shadow:0 8px 24px var(--shadow-md);
  min-width:180px;
  z-index:300;
  overflow:hidden;
  display:none;
}
.dropdown-menu.show{display:block;}
.dropdown-menu button{
  display:flex; align-items:center; gap:0.5rem;
  width:100%;
  padding:0.65rem 1rem;
  border:none;
  background:none;
  font-family:'Source Sans 3',sans-serif;
  font-size:0.85rem;
  color:var(--text);
  cursor:pointer;
  text-align:left;
}
.dropdown-menu button:hover{background:var(--bg-warm);}
.dropdown-menu hr{border:none; border-top:1px solid var(--border-light); margin:0;}

/* Toast */
.toast{
  position:fixed;
  bottom:2rem;
  left:50%;
  transform:translateX(-50%) translateY(80px);
  background:var(--text);
  color:#fff;
  padding:0.75rem 1.25rem;
  border-radius:10px;
  font-size:0.85rem;
  z-index:2000;
  transition:transform 0.3s;
  box-shadow:0 8px 24px rgba(0,0,0,0.2);
  max-width:min(720px, calc(100vw - 2rem));
  text-align:center;
}
.toast.show{transform:translateX(-50%) translateY(0);}

@media (max-width:768px){
  .app-header{padding:0 1rem;}
  .header-title{font-size:1.2rem;}
  .tree-title-section h1{font-size:1.8rem;}
  .detail-panel{width:100%; right:-100%;}
  .tree-node .photo{width:60px; height:60px;}
  .tree-node .name{font-size:0.7rem;}
}

::-webkit-scrollbar{width:8px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--border); border-radius:4px;}